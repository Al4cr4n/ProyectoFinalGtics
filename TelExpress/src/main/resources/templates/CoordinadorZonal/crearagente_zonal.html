<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="/assets/" data-template="vertical-menu-template-free" xmlns="http://www.w3.org/1999/html" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crear- CoordinadorZonal</title>
    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="/assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="/assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="/assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="/assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Helpers -->
    <script src="/assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files -->
    <script src="/assets/js/config.js"></script>

    <!--TelExpress fuente de letra-->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        .toggle-password, .toggle-password-confirm {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6c757d; /* Color gris */
        }

        .toggle-password:hover, .toggle-password-confirm:hover {
            color: #495057; /* Color más oscuro al pasar el ratón */
        }

        .position-relative {
            position: relative; /* Asegura que el ícono se alinee dentro del contenedor */
        }
    </style>
</head>

<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:insert="~{CoordinadorZonal/fragments/menu.html::menu}"></div> <!-- este es el menu -->

        <!-- Layout container -->
        <div class="layout-page">
            <div th:insert="~{CoordinadorZonal/fragments/navbar.html::navbar}"></div> <!-- este es el navbar -->

            <!--Este es el contenedor principal-->
            <div class="container-xxl flex-grow-1 container-p-y">
                <h4 style="font-family: 'Poppins', sans-serif; color: #7367F0; font-weight: bold; padding-top: 1rem; padding-bottom: 1rem; margin-bottom: 1rem; text-align: center; font-size: 40px;">Crear agente de compra</h4>
                <div class="card">
                    <div class="card-body">
                        <!--FORMULARIO-->
                        <form id="formCrearAgente" method="post" th:action="@{'/coordinador/guardaragente_zonal'}">
                            <div class="row">
                                <input th:field="*{agente.id}" name="id" type="hidden" />
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Nombre:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.nombre}" type="text" class="form-control" id="basic-nombre" placeholder="Ingresa el nombre" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Apellido:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.apellido}" type="text" class="form-control" id="basic-apellido" placeholder="Ingresa el apellido" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Correo electrónico:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.correo}" type="text" class="form-control" id="basic-correo" placeholder="Ingresa el email" pattern="[a-zA-Z0-9._%+-]+@" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Contraseña:</label>
                                    <div class="col-md-10 position-relative">
                                        <input th:field="*{agente.contrasena}" type="password" class="form-control" id="basic-password"
                                               placeholder="Ingresa la contraseña"
                                               pattern="^(?=.*[A-Za-z])(?=.*\\d)(?=.*[!@#$%^&*()_+\\-=\\[\\]{};':&quot;\\\\|,.&lt;&gt;\\/\\?]).{8,16}$"
                                               title="La contraseña debe tener al menos 1 número, 2 caracteres especiales, 1 letra, y una longitud entre 8 y 16 caracteres."
                                               minlength="8" maxlength="16" required />
                                        <i class="fa fa-eye toggle-password"></i>
                                        <div class="invalid-feedback">
                                            La contraseña debe tener al menos 1 número, 2 caracteres especiales, 1 letra, y una longitud entre 8 y 16 caracteres.
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Repetir Contraseña:</label>
                                    <div class="col-md-10 position-relative">
                                        <input type="password" class="form-control" id="basic-password-confirm"
                                               placeholder="Repite la contraseña" minlength="8" maxlength="16" required />
                                        <i class="fa fa-eye toggle-password-confirm"></i>
                                        <div class="invalid-feedback">
                                            Las contraseñas no coinciden.
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">DNI:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.dni}" type="text" class="form-control" id="basic-dni" placeholder="Ingresa el DNI" maxlength="8" pattern="\d{8}" oninput="this.value = this.value.replace(/\D/g, '')" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Teléfono:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.telefono}" type="text" class="form-control" id="basic-telefono" placeholder="Ingresa el número telefónico" maxlength="11" oninput="this.value = this.value.replace(/\D/g, '')" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Código despachador:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.despachador}" type="text" class="form-control" id="basic-codigo-despachador" placeholder="Ingresa el código despachador" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">RUC:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.ruc}" type="text" class="form-control" id="basic-ruc" placeholder="Ingresa el RUC" maxlength="11" pattern="\d{11}" oninput="this.value = this.value.replace(/\D/g, '')" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Razón Social:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.razonSocial}" type="text" class="form-control" id="basic-razon-social" placeholder="Ingrese la razón social" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Dirección:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.direccion}" type="text" class="form-control" id="basic-direccion" placeholder="Ingresa la dirección" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Distrito:</label>
                                    <div class="col-md-10">
                                        <select th:field="*{agente.distrito.id}" class="form-select" required>
                                            <option value="" disable selected>Seleccione un distrito</option>
                                            <option th:each="distrito : ${distritos}" th:value="${distrito.id}" th:text="${distrito.nombredistrito}"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Código de jurisdicción:</label>
                                    <div class="col-md-10">
                                        <input th:field="*{agente.jurisdiccion}" type="text" class="form-control" id="basic-codigo-jurisdiccion" placeholder="Ingresa el código de jurisdicción" required />
                                    </div>
                                </div>
                                <div class="mb-3 row">
                                    <label class="form-label col-md-2">Zona:</label>
                                    <div class="col-md-10">
                                        <input type="text" class="form-control" id="basic-zona" th:value="${session.usuario.zona.nombre}" readonly required style="background: linear-gradient(#ffffff75,#d8d8d885,#ffffff);" />
                                    </div>
                                </div>
                            </div>

                            <!-- BOTON DE CREAR AGENTE -->
                            <div class="text-center mt-3">
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#confirmModal" style="background-color: #e89b85; border-color: #e89b85; font-size: 17px; font-family: 'Poppins', sans-serif;">Enviar</button>
                                <a th:href="@{/coordinador/listaagente_zonal}" class="btn btn-danger">Cancelar</a>
                                <div id="errorMessages" class="text-danger mt-2" style="display: none;"></div>
                            </div>
                            <!--/ BOTON DE CREAR AGENTE -->
                        </form>
                        <!--FORMULARIO-->
                    </div>

                    <!-- Confirmation Modal -->
                    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="confirmModalLabel">Confirmar solicitud</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Se creará el agente
                                </div>
                                <div class="modal-footer">
                                    <a th:href="@{'/coordinador/listaagente_zonal'}" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</a>
                                    <button type="button" class="btn btn-primary" id="confirmarRegistro">Confirmar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bootstrap JS -->
                    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>

                    <script>
                        // Validación de formulario y coincidencia de contraseñas
                        document.getElementById('formCrearAgente').addEventListener('submit', function(event) {
                            event.preventDefault(); // Evita el envío inmediato del formulario

                            const inputs = document.querySelectorAll('.form-control');
                            const errorMessages = document.getElementById('errorMessages');
                            const password = document.getElementById('basic-password');
                            const confirmPassword = document.getElementById('basic-password-confirm');
                            let allValid = true;

                            // Validar campos vacíos
                            inputs.forEach((input) => {
                                if (input.value.trim() === '' && input.id !== 'basic-zona') {
                                    input.classList.add('is-invalid');
                                    allValid = false;
                                } else {
                                    input.classList.remove('is-invalid');
                                }
                            });

                            // Validar coincidencia de contraseñas
                            if (password.value !== confirmPassword.value) {
                                confirmPassword.classList.add('is-invalid');
                                errorMessages.textContent = 'Las contraseñas no coinciden.';
                                errorMessages.style.display = 'block';
                                allValid = false;
                            } else {
                                confirmPassword.classList.remove('is-invalid');
                            }

                            if (!allValid) {
                                return;
                            }

                            // Mostrar modal de confirmación
                            var confirmationModal = new bootstrap.Modal(document.getElementById('confirmModal'));
                            confirmationModal.show();
                        });

                        // Enviar formulario al confirmar
                        document.getElementById('confirmarRegistro').addEventListener('click', function() {
                            document.getElementById('formCrearAgente').submit();
                        });

                        // Quitar mensajes de error dinámicamente
                        document.querySelectorAll('.form-control').forEach((input) => {
                            input.addEventListener('input', function() {
                                if (this.value.trim() !== '') {
                                    this.classList.remove('is-invalid');
                                }
                            });
                        });

                        // Alternar visibilidad de contraseñas
                        document.querySelectorAll('.toggle-password').forEach(toggle => {
                            toggle.addEventListener('click', function() {
                                const input = this.previousElementSibling;
                                if (input.type === 'password') {
                                    input.type = 'text';
                                    this.classList.replace('fa-eye', 'fa-eye-slash');
                                } else {
                                    input.type = 'password';
                                    this.classList.replace('fa-eye-slash', 'fa-eye');
                                }
                            });
                        });

                        document.querySelectorAll('.toggle-password-confirm').forEach(toggle => {
                            toggle.addEventListener('click', function() {
                                const input = this.previousElementSibling;
                                if (input.type === 'password') {
                                    input.type = 'text';
                                    this.classList.replace('fa-eye', 'fa-eye-slash');
                                } else {
                                    input.type = 'password';
                                    this.classList.replace('fa-eye-slash', 'fa-eye');
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
        <!-- Content wrapper -->
    </div>
</div>

<!-- Core JS -->
<script src="/assets/vendor/libs/jquery/jquery.js"></script>
<script src="/assets/vendor/libs/popper/popper.js"></script>
<script src="/assets/vendor/js/bootstrap.js"></script>
<script src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
<script src="/assets/vendor/js/menu.js"></script>

<!-- Vendors JS -->
<script src="/assets/vendor/libs/apex-charts/apexcharts.js"></script>

<!-- Main JS -->
<script src="/assets/js/main.js"></script>
</body>
</html>
