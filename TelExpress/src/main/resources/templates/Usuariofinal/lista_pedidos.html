<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr"
      data-theme="theme-default"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, " />
    <title>Lista de Pedidos</title>
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon/favicon.ico" />
    <link rel="stylesheet" href="/assets/vendor/fonts/boxicons.css" />
    <link rel="stylesheet" href="/assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="/assets/css/demo.css" />
    <link rel="stylesheet" href="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="/assets/vendor/libs/apex-charts/apex-charts.css" />
    <script src="/assets/vendor/js/helpers.js"></script>
    <script src="/assets/js/config.js"></script>
    <style>
        /* Custom styles for status labels */
        .status-label {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            color: #fff;
        }
        .validacion { background-color: #d1bf00; }
        .creado { background-color: #e1c20f; }
        .proceso { background-color: #1fabc5; }
        .aduanas { background-color: #e35b42; }
        .pais { background-color: #f8c500; }
        .ruta { background-color: #6e9931; }
        .recibido { background-color: #534482; }

        /* Sidebar icons */
        .menu-icon {
            margin-right: 8px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination button {
            border: none;
            background-color: #f1f1f1;
            padding: 10px;
            margin: 2px;
            cursor: pointer;
        }

        .pagination button:hover {
            background-color: #ddd;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .modal-footer button {
            margin-left: 10px;
        }

        /* Button styles */
        .btn-cancel {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        .btn-cancel:hover {
            background-color: #0056b3;
        }

        .btn-delete {
            background-color: #dc3545;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
        }

        .btn-delete:hover {
            background-color: #c82333;
        }

        /* Dropdown for sorting */
        .dropdown-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        /* Styling for the radio and checkbox button groups */
        .radio-options, .checkbox-options {
            display: none; /* Hidden by default */
            position: absolute;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1;
            width: 150px;
            top: 100%; /* Position below the dropdown-container */
            left: 0;
        }

        /* Style the radio buttons */
        .radio-options input[type="radio"],
        .checkbox-options input[type="checkbox"] {
            margin-right: 8px;
        }
    </style>
</head>
<body>
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:insert="~{Usuariofinal/fragments/menu.html::menu}"></div> <!-- este es el menu -->

        <!-- /Sidebar -->

        <!-- Main content -->
        <div class="layout-page">
            <div th:insert="~{Usuariofinal/fragments/navbar.html::navbar}"></div> <!-- este es el navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Orders List -->
                <div class="container-xxl flex-grow-1 container-p-y">
                    <h4 class="fw-bold py-3 mb-4">Lista de pedidos</h4>
                    <!-- Filters and Sorting -->
                    <div class="mb-4">
                        <!-- Search bar -->
                        <input type="text" placeholder="Búsqueda" class="form-control" style="width: 200px; display: inline-block;">
                        <i class="bx bx-search" style="margin-left: -30px;"></i>


                        <!-- Dropdown for Estado -->
                        <div class="dropdown-container" id="estado-sort" style="margin-left: 10px;">
                            <i class="bx bx-sort"></i> Estado
                            <div id="checkbox-options-estado" class="checkbox-options">
                                <label>
                                    <input type="checkbox" name="estado" value="validacion"> En validación
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="creado"> Creado
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="proceso"> En proceso
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="pais"> Arribo al país
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="aduanas"> En aduanas
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="ruta"> En rutas
                                </label><br>
                                <label>
                                    <input type="checkbox" name="estado" value="recibido"> Recibido
                                </label>
                            </div>
                        </div>

                        <!-- Export button -->
                        <button class="btn btn-outline-primary float-end">Exportar <i class="bx bx-export"></i></button>
                    </div>
                    <!-- Orders Table -->
                    <div class="card">
                        <h5 class="card-header">Órdenes</h5>
                        <div class="table-responsive text-nowrap">
                            <table class="table">
                                <thead class="table-light">
                                <tr>
                                    <th>Orden</th>
                                    <th>Fecha de solicitud</th>
                                    <th>Estado</th>
                                    <th>Agente a cargo</th>
                                    <th>Editar</th>
                                    <th>Eliminar</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Iteración sobre las órdenes -->
                                <tr th:each="orden : ${ordenes}">
                                    <td th:text="${orden.idOrdenes}"></td>
                                    <!-- Asegúrate de que el usuario no sea null antes de mostrar el nombre
                                         Porque en la tabla usuario está borrado el id 25 -->
                                    <td  th:text="${#dates.format(orden.fechaCreacion, 'yyyy-MM-dd')}"></td>
                                    <td>
                                            <span th:text="${orden.estadoOrdenes}"
                                                  th:class="'badge ' + (${orden.estadoOrdenes == 'CREADO'} ? 'bg-label-warning' : (${orden.estadoOrdenes == 'EN VALIDACIÓN'} ? 'bg-label-danger' : 'bg-label-success'))"></span>
                                    </td>
                                    <td th:text="${orden.usuario.nombre}" ></td>

                                    <td>
                                        <a class="btn btn-sm btn-primary" th:href="@{'/usuario/pedidos/editar?id=' + ${orden.idOrdenes}}">
                                            <i class="bx bx-edit-alt"></i>
                                        </a>
                                        <a class="btn btn-sm btn-danger" th:href="@{'/usuario/pedidos/borrar?id=' + ${orden.idOrdenes}}">
                                            <i class="bx bx-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- Pagination -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                            </ul>
                        </nav>
                    </div>

                    <!-- Modal for delete confirmation -->
                    <div id="deleteModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                Se va a eliminar la siguiente orden
                            </div>
                            <div class="modal-body">
                                Luego de eliminar la orden se procederá el reembolso correspondiente, por favor espere a que nos comuniquemos con usted por correo electrónico.
                            </div>
                            <div class="modal-footer">
                                <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
                                <button class="btn-delete">Eliminar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /Content wrapper -->
        </div>
        <!-- /Main content -->
    </div>
    <!-- / Layout page -->
</div>

<!-- JS for modal and dropdowns -->
<script>
    function openModal() {
        document.getElementById('deleteModal').style.display = "block";
    }
    function closeModal() {
        document.getElementById('deleteModal').style.display = "none";
    }

    // JavaScript to toggle the display of the radio button groups

    document.getElementById('estado-sort').addEventListener('click', function() {
        var options = document.getElementById('checkbox-options-estado');
        // Toggle visibility
        if (options.style.display === 'block') {
            options.style.display = 'none';
        } else {
            options.style.display = 'block';
        }
    });

    // Hide options if clicked outside
    document.addEventListener('click', function(event) {
        var optionsFecha = document.getElementById('radio-options-fecha');
        var optionsNumeroOrden = document.getElementById('radio-options-numero-orden');
        var optionsEstado = document.getElementById('checkbox-options-estado');
        var fechaSort = document.getElementById('fecha-sort');
        var numeroOrdenSort = document.getElementById('numero-orden-sort');
        var estadoSort = document.getElementById('estado-sort');

        // Check if the click is outside of the 'radio-options' and their parent elements
        if (!optionsFecha.contains(event.target) && !fechaSort.contains(event.target)) {
            optionsFecha.style.display = 'none';
        }
        if (!optionsNumeroOrden.contains(event.target) && !numeroOrdenSort.contains(event.target)) {
            optionsNumeroOrden.style.display = 'none';
        }
        if (!optionsEstado.contains(event.target) && !estadoSort.contains(event.target)) {
            optionsEstado.style.display = 'none';
        }
    });
</script>
</body>
</html>
